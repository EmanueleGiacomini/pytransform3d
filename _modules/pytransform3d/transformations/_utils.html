<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pytransform3d.transformations._utils &#8212; pytransform3d 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          pytransform3d</a>
        <span class="navbar-text navbar-version pull-left"><b>2.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../index.html">Contents</a></li>
                <li><a href="../../../_auto_examples/index.html">Examples</a></li>
                <li><a href="../../../api.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notation.html">Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rotations.html">SO(3): 3D Rotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transformations.html">SE(3): 3D Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transformation_ambiguities.html">Transformation Ambiguities and Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../euler_angles.html">Euler Angles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transformation_modeling.html">Modeling Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transform_manager.html">Managing Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../camera.html">Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../animations.html">Animations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_auto_examples/index.html">Examples</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for pytransform3d.transformations._utils</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Utility functions for transforms.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">..rotations</span> <span class="kn">import</span> <span class="n">check_matrix</span><span class="p">,</span> <span class="n">norm_vector</span><span class="p">,</span> <span class="n">check_skew_symmetric_matrix</span>


<div class="viewcode-block" id="check_transform"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_transform.html#pytransform3d.transformations.check_transform">[docs]</a><span class="k">def</span> <span class="nf">check_transform</span><span class="p">(</span><span class="n">A2B</span><span class="p">,</span> <span class="n">strict_check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation of transform.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A2B : array-like, shape (4, 4)</span>
<span class="sd">        Transform from frame A to frame B</span>

<span class="sd">    strict_check : bool, optional (default: True)</span>
<span class="sd">        Raise a ValueError if the transformation matrix is not numerically</span>
<span class="sd">        close enough to a real transformation matrix. Otherwise we print a</span>
<span class="sd">        warning.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A2B : array, shape (4, 4)</span>
<span class="sd">        Validated transform from frame A to frame B</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A2B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">A2B</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">A2B</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">A2B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">A2B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected homogeneous transformation matrix with &quot;</span>
                         <span class="s2">&quot;shape (4, 4), got array-like object with shape </span><span class="si">%s</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="n">A2B</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="n">check_matrix</span><span class="p">(</span><span class="n">A2B</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">strict_check</span><span class="o">=</span><span class="n">strict_check</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">A2B</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])):</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Excpected homogeneous transformation matrix with &quot;</span>
                     <span class="s2">&quot;[0, 0, 0, 1] at the bottom, got </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">A2B</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">strict_check</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A2B</span></div>


<div class="viewcode-block" id="check_pq"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_pq.html#pytransform3d.transformations.check_pq">[docs]</a><span class="k">def</span> <span class="nf">check_pq</span><span class="p">(</span><span class="n">pq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation for position and orientation quaternion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pq : array-like, shape (7,)</span>
<span class="sd">        Position and orientation quaternion: (x, y, z, qw, qx, qy, qz)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pq : array, shape (7,)</span>
<span class="sd">        Validated position and orientation quaternion:</span>
<span class="sd">         (x, y, z, qw, qx, qy, qz)</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pq</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">pq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected position and orientation quaternion in a &quot;</span>
                         <span class="s2">&quot;1D array, got array-like object with shape </span><span class="si">%s</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">pq</span></div>


<div class="viewcode-block" id="check_screw_parameters"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_screw_parameters.html#pytransform3d.transformations.check_screw_parameters">[docs]</a><span class="k">def</span> <span class="nf">check_screw_parameters</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">s_axis</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Input validation of screw parameters.</span>

<span class="sd">    The parameters :math:`(\boldsymbol{q}, \hat{\boldsymbol{s}}, h)`</span>
<span class="sd">    describe a screw.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array-like, shape (3,)</span>
<span class="sd">        Vector to a point on the screw axis</span>

<span class="sd">    s_axis : array-like, shape (3,)</span>
<span class="sd">        Direction vector of the screw axis</span>

<span class="sd">    h : float</span>
<span class="sd">        Pitch of the screw. The pitch is the ratio of translation and rotation</span>
<span class="sd">        of the screw axis. Infinite pitch indicates pure translation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : array, shape (3,)</span>
<span class="sd">        Vector to a point on the screw axis. Will be set to zero vector when</span>
<span class="sd">        pitch is infinite (pure translation).</span>

<span class="sd">    s_axis : array, shape (3,)</span>
<span class="sd">        Unit direction vector of the screw axis</span>

<span class="sd">    h : float</span>
<span class="sd">        Pitch of the screw. The pitch is the ratio of translation and rotation</span>
<span class="sd">        of the screw axis. Infinite pitch indicates pure translation.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s_axis</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s_axis</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">s_axis</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected 3D vector with shape (3,), got array-like &quot;</span>
                         <span class="s2">&quot;object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s_axis</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">s_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;s_axis must not have norm 0&quot;</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected 3D vector with shape (3,), got array-like &quot;</span>
                         <span class="s2">&quot;object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>  <span class="c1"># pure translation</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">q</span><span class="p">,</span> <span class="n">norm_vector</span><span class="p">(</span><span class="n">s_axis</span><span class="p">),</span> <span class="n">h</span></div>


<div class="viewcode-block" id="check_screw_axis"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_screw_axis.html#pytransform3d.transformations.check_screw_axis">[docs]</a><span class="k">def</span> <span class="nf">check_screw_axis</span><span class="p">(</span><span class="n">screw_axis</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Input validation of screw axis.</span>

<span class="sd">    A screw axis</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathcal{S}</span>
<span class="sd">        = \left[\begin{array}{c}\boldsymbol{\omega}\\</span>
<span class="sd">          \boldsymbol{v}\end{array}\right] \in \mathbb{R}^6</span>

<span class="sd">    consists of a part that describes rotation and a part that describes</span>
<span class="sd">    translation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    screw_axis : array-like, shape (6,)</span>
<span class="sd">        Screw axis described by 6 values</span>
<span class="sd">        (omega_1, omega_2, omega_3, v_1, v_2, v_3),</span>
<span class="sd">        where the first 3 components are related to rotation and the last 3</span>
<span class="sd">        components are related to translation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    screw_axis : array, shape (6,)</span>
<span class="sd">        Screw axis described by 6 values</span>
<span class="sd">        (omega_1, omega_2, omega_3, v_1, v_2, v_3),</span>
<span class="sd">        where the first 3 components are related to rotation and the last 3</span>
<span class="sd">        components are related to translation.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">screw_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">screw_axis</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">screw_axis</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">screw_axis</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected 3D vector with shape (6,), got array-like &quot;</span>
                         <span class="s2">&quot;object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">screw_axis</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>

    <span class="n">omega_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">screw_axis</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">omega_norm</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">omega_norm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Norm of rotation axis must either be 0 or 1, but it is </span><span class="si">%g</span><span class="s2">.&quot;</span>
            <span class="o">%</span> <span class="n">omega_norm</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">omega_norm</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
        <span class="n">v_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">screw_axis</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_norm</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If the norm of the rotation axis is 0, then the direction &quot;</span>
                <span class="s2">&quot;vector must have norm 1, but it is </span><span class="si">%g</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">v_norm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">screw_axis</span></div>


<div class="viewcode-block" id="check_exponential_coordinates"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_exponential_coordinates.html#pytransform3d.transformations.check_exponential_coordinates">[docs]</a><span class="k">def</span> <span class="nf">check_exponential_coordinates</span><span class="p">(</span><span class="n">Stheta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation for exponential coordinates of transformation.</span>

<span class="sd">    Exponential coordinates of a transformation :math:`\\mathcal{S}\\theta</span>
<span class="sd">    \\in \\mathbb{R}^6` are the product of a screw axis and a scalar</span>
<span class="sd">    :math:`\\theta`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Stheta : array-like, shape (6,)</span>
<span class="sd">        Exponential coordinates of transformation:</span>
<span class="sd">        S * theta = (omega_1, omega_2, omega_3, v_1, v_2, v_3) * theta,</span>
<span class="sd">        where the first 3 components are related to rotation and the last 3</span>
<span class="sd">        components are related to translation. Theta is the rotation angle</span>
<span class="sd">        and h * theta the translation. Theta should be &gt;= 0. Negative rotations</span>
<span class="sd">        will be represented by a negative screw axis instead. This is relevant</span>
<span class="sd">        if you want to recover theta from exponential coordinates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Stheta : array, shape (6,)</span>
<span class="sd">        Exponential coordinates of transformation:</span>
<span class="sd">        S * theta = (omega_1, omega_2, omega_3, v_1, v_2, v_3) * theta,</span>
<span class="sd">        where the first 3 components are related to rotation and the last 3</span>
<span class="sd">        components are related to translation. Theta is the rotation angle</span>
<span class="sd">        and h * theta the translation. Theta should be &gt;= 0. Negative rotations</span>
<span class="sd">        will be represented by a negative screw axis instead. This is relevant</span>
<span class="sd">        if you want to recover theta from exponential coordinates.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Stheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Stheta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Stheta</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">Stheta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected array-like with shape (6,), got array-like &quot;</span>
                         <span class="s2">&quot;object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Stheta</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">Stheta</span></div>


<div class="viewcode-block" id="check_screw_matrix"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_screw_matrix.html#pytransform3d.transformations.check_screw_matrix">[docs]</a><span class="k">def</span> <span class="nf">check_screw_matrix</span><span class="p">(</span><span class="n">screw_matrix</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">strict_check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation for screw matrix.</span>

<span class="sd">    A screw matrix consists of the cross-product matrix of a rotation</span>
<span class="sd">    axis and a translation.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\left[\\mathcal S\\right]</span>
<span class="sd">        =</span>
<span class="sd">        \\left( \\begin{array}{cc}</span>
<span class="sd">            \\left[\\boldsymbol{\\omega}\\right] &amp; \\boldsymbol v\\\\</span>
<span class="sd">            \\boldsymbol 0 &amp; 0\\\\</span>
<span class="sd">        \\end{array} \\right)</span>
<span class="sd">        =</span>
<span class="sd">        \\left(</span>
<span class="sd">        \\begin{matrix}</span>
<span class="sd">        0 &amp; -\\omega_3 &amp; \\omega_2 &amp; v_1\\\\</span>
<span class="sd">        \\omega_3 &amp; 0 &amp; -\\omega_1 &amp; v_2\\\\</span>
<span class="sd">        -\\omega_2 &amp; \\omega_1 &amp; 0 &amp; v_3\\\\</span>
<span class="sd">        0 &amp; 0 &amp; 0 &amp; 0\\\\</span>
<span class="sd">        \\end{matrix}</span>
<span class="sd">        \\right)</span>
<span class="sd">        \\in \\mathbb{R}^{4 \\times 4}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    screw_matrix : array-like, shape (4, 4)</span>
<span class="sd">        A screw matrix consists of a cross-product matrix that represents an</span>
<span class="sd">        axis of rotation, a translation, and a row of zeros.</span>

<span class="sd">    tolerance : float, optional (default: 1e-6)</span>
<span class="sd">        Tolerance threshold for checks.</span>

<span class="sd">    strict_check : bool, optional (default: True)</span>
<span class="sd">        Raise a ValueError if [omega].T is not numerically close enough to</span>
<span class="sd">        -[omega]. Otherwise we print a warning.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    screw_matrix : array, shape (4, 4)</span>
<span class="sd">        A screw matrix consists of a cross-product matrix that represents an</span>
<span class="sd">        axis of rotation, a translation, and a row of zeros.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">screw_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">screw_matrix</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">screw_matrix</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">screw_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span>
            <span class="ow">or</span> <span class="n">screw_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected array-like with shape (4, 4), got array-like &quot;</span>
            <span class="s2">&quot;object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">screw_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">screw_matrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Last row of screw matrix must only contains zeros.&quot;</span><span class="p">)</span>

    <span class="n">check_skew_symmetric_matrix</span><span class="p">(</span><span class="n">screw_matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">strict_check</span><span class="p">)</span>

    <span class="n">omega_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
        <span class="p">[</span><span class="n">screw_matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">screw_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">screw_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">omega_norm</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">omega_norm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Norm of rotation axis must either be 0 or 1, but it is </span><span class="si">%g</span><span class="s2">.&quot;</span>
            <span class="o">%</span> <span class="n">omega_norm</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">omega_norm</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
        <span class="n">v_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">screw_matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_norm</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
                <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_norm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If the norm of the rotation axis is 0, then the direction &quot;</span>
                <span class="s2">&quot;vector must have norm 1 or 0, but it is </span><span class="si">%g</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">v_norm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">screw_matrix</span></div>


<div class="viewcode-block" id="check_transform_log"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_transform_log.html#pytransform3d.transformations.check_transform_log">[docs]</a><span class="k">def</span> <span class="nf">check_transform_log</span><span class="p">(</span><span class="n">transform_log</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">strict_check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation for logarithm of transformation.</span>

<span class="sd">    The logarithm of a transformation :math:`\\left[\\mathcal{S}\\right]\\theta</span>
<span class="sd">    \\in \\mathbb{R}^{4 \\times 4}` are the product of a screw matrix and a</span>
<span class="sd">    scalar :math:`\\theta`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    transform_log : array-like, shape (4, 4)</span>
<span class="sd">        Matrix logarithm of transformation matrix: [S] * theta.</span>

<span class="sd">    tolerance : float, optional (default: 1e-6)</span>
<span class="sd">        Tolerance threshold for checks.</span>

<span class="sd">    strict_check : bool, optional (default: True)</span>
<span class="sd">        Raise a ValueError if [omega].T is not numerically close enough to</span>
<span class="sd">        -[omega]. Otherwise we print a warning.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    transform_log : array, shape (4, 4)</span>
<span class="sd">        Matrix logarithm of transformation matrix: [S] * theta.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">transform_log</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">transform_log</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">transform_log</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span>
            <span class="ow">or</span> <span class="n">transform_log</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected array-like with shape (4, 4), got array-like &quot;</span>
            <span class="s2">&quot;object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">transform_log</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">transform_log</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Last row of logarithm of transformation must only &quot;</span>
            <span class="s2">&quot;contains zeros.&quot;</span><span class="p">)</span>

    <span class="n">check_skew_symmetric_matrix</span><span class="p">(</span><span class="n">transform_log</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">strict_check</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transform_log</span></div>


<div class="viewcode-block" id="check_dual_quaternion"><a class="viewcode-back" href="../../../_apidoc/pytransform3d.transformations.check_dual_quaternion.html#pytransform3d.transformations.check_dual_quaternion">[docs]</a><span class="k">def</span> <span class="nf">check_dual_quaternion</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation of dual quaternion representation.</span>

<span class="sd">    See http://web.cs.iastate.edu/~cs577/handouts/dual-quaternion.pdf</span>

<span class="sd">    A dual quaternion is defined as</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\sigma = p + \\epsilon q,</span>

<span class="sd">    where :math:`p` and :math:`q` are both quaternions and :math:`\\epsilon`</span>
<span class="sd">    is the dual unit with :math:`\\epsilon^2 = 0`. The first quaternion is</span>
<span class="sd">    also called the real part and the second quaternion is called the dual</span>
<span class="sd">    part.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dq : array-like, shape (8,)</span>
<span class="sd">        Dual quaternion to represent transform:</span>
<span class="sd">        (pw, px, py, pz, qw, qx, qy, qz)</span>

<span class="sd">    unit : bool, optional (default: True)</span>
<span class="sd">        Normalize the dual quaternion so that it is a unit dual quaternion.</span>
<span class="sd">        A unit dual quaternion has the properties</span>
<span class="sd">        :math:`p_w^2 + p_x^2 + p_y^2 + p_z^2 = 1` and</span>
<span class="sd">        :math:`p_w q_w + p_x q_x + p_y q_y + p_z q_z = 0`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dq : array, shape (8,)</span>
<span class="sd">        Unit dual quaternion to represent transform:</span>
<span class="sd">        (pw, px, py, pz, qw, qx, qy, qz)</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dq</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">dq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected dual quaternion with shape (8,), got &quot;</span>
                         <span class="s2">&quot;array-like object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dq</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
        <span class="c1"># Norm of a dual quaternion only depends on the real part because</span>
        <span class="c1"># the dual part vanishes with epsilon ** 2 = 0.</span>
        <span class="n">real_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dq</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">real_norm</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dq</span><span class="p">[</span><span class="mi">4</span><span class="p">:]]</span>
        <span class="k">return</span> <span class="n">dq</span> <span class="o">/</span> <span class="n">real_norm</span>
    <span class="k">return</span> <span class="n">dq</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014-2022, Alexander Fabisch, DFKI GmbH, Robotics Innovation Center.<br/>
      Last updated on Sep 17, 2022.<br/>
    </p>
  </div>
</footer>
  </body>
</html>